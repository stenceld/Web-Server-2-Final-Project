<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineReview</title>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>

    <header>
        <nav>
            <h1>CineReview</h1>
            <ul>
                <li><a href="/index.html">Home</a></li>
                <li><a href="#">Movies</a></li>
                <li><a href="#">TV Shows</a></li>
                <li><a href="#">Top Rated</a></li>
                <li><a href="/html/movie_review.php">Review a Movie</a></li>
                <li><a href="/html/show_review.php">Review a Show</a></li>
            </ul>
            <section id="login">
                <!-- Will be populated by JavaScript -->
                <a href="/html/login.php">
                    <button>Login</button>
                </a>
            </section>
        </nav>

        <form method="get" action="process.php">
            <label>Search Reviews: </label>
            <input type="text" name="searchBar" id="searchBar" placeholder="Enter a title">
            <input type="submit" name="search" id="search" value="Search">
        </form>
    </header>

    <main>

        <div id="messageContainer"></div>

        <p id="test" name="test">If you see this: test failed.</p>

        <section id="FeaturedMovie">
            <h2>Echoes of Tomorrow</h2>
            <p>In a world where memories can be extracted and sold...</p>
            <form method="get" action="viewReviews.php">
                <input type="submit" name="myReviews" id="myReviews" value="Your Reviews">
            </form>
        </section>

        <section id="PopularMovies">
            <h2>Popular Movies</h2>
            <ul>
                <li><figure><img src="#" alt=""><figcaption>Echoes of Tomorrow</figcaption></figure></li>
                <li><figure><img src="#" alt=""><figcaption>Shadow Protocol</figcaption></figure></li>
                <li><figure><img src="#" alt=""><figcaption>Velocity</figcaption></figure></li>
                <li><figure><img src="#" alt=""><figcaption>The Last Celebration</figcaption></figure></li>
                <li><figure><img src="#" alt=""><figcaption>Reflections</figcaption></figure></li>
            </ul>
        </section>

        <section id="recentReviews">
            <h2>Recent Reviews</h2>

            <article>
                <h3 id="recentHeading1">Sarah Mitchell — Echoes of Tomorrow</h3>
                <p id="recentRating1">5/5</p>
                <p id="recentReview1">An absolute masterpiece! The cinematography is breathtaking...</p>
            </article>

            <article>
                <h3 id="recentHeading2">Sarah Mitchell — Echoes of Tomorrow</h3>
                <p id="recentRating2">5/5</p>
                <p id="recentReview2">An absolute masterpiece! The cinematography is breathtaking...</p>
            </article>

            <article>
                <h3 id="recentHeading3">Sarah Mitchell — Echoes of Tomorrow</h3>
                <p id="recentRating3">5/5</p>
                <p id="recentReview3">An absolute masterpiece! The cinematography is breathtaking...</p>
            </article>

        </section>

    </main>

    <footer>
        <section id="About">
            <h4>CineReview</h4>
            <p>Your trusted source for honest movie reviews.</p>
        </section>

        <section id="FooterRow1">
            <h4>Movies</h4>
            <ul>
                <li><a href="#">Now Playing</a></li>
                <li><a href="#">Coming Soon</a></li>
                <li><a href="#">Top Rated</a></li>
            </ul>
        </section>

        <section id="FooterRow2">
            <h4>Community</h4>
            <ul>
                <li><a href="#">Reviews</a></li>
                <li><a href="#">Discussions</a></li>
                <li><a href="/html/movie_review.php">Write a Review</a></li>
            </ul>
        </section>

        <section id="FooterRow3">
            <h4>Company</h4>
            <ul>
                <li><a href="#">About Us</a></li>
                <li><a href="#">Contact</a></li>
                <li><a href="#">Privacy Policy</a></li>
            </ul>
        </section>
    </footer>

    <script src="/dataQuery.js"></script>
    <script>
        // Check login status and update UI
        async function checkLoginStatus() {
            try {
                let response = await fetch('/process.php?checkSession=true');
                let data = await response.json();
                
                const loginSection = document.getElementById('login');
                
                if (data.logged_in) {
                    loginSection.innerHTML = `
                        <span class="welcome">Welcome, ${data.username}</span>
                        <a href="/process.php?logout=true">
                            <button>Logout</button>
                        </a>
                    `;
                } else {
                    loginSection.innerHTML = `
                        <a href="/html/login.php">
                            <button>Login</button>
                        </a>
                    `;
                }
            } catch (error) {
                console.error('Error checking login status:', error);
            }
        }

        // Check for success messages in URL
        function checkSuccessMessages() {
            const urlParams = new URLSearchParams(window.location.search);
            const success = urlParams.get('success');
            const messageContainer = document.getElementById('messageContainer');
            
            if (success) {
                let message = '';
                switch (success) {
                    case 'logged_in':
                        message = 'Welcome back!';
                        break;
                    case 'logged_out':
                        message = 'You have been logged out successfully.';
                        break;
                    case 'review_submitted':
                        message = 'Your review has been submitted successfully!';
                        break;
                    default:
                        message = 'Success!';
                }
                messageContainer.innerHTML = `<p class="success-message">${message}</p>`;
            }
        }

        // Run on page load
        checkLoginStatus();
        checkSuccessMessages();
    </script>
</body>
</html>
